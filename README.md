# MuLyriX (Music & Lyrics)
## Используемые технологии

Этот проект был создан для ознакомления с [Node.js](https://nodejs.org) и [React](https://facebook.github.io/react/) и демонстрации полученных навыков.

[Фронтенд](ui) я сгенерировал с помощью утилиты [Create React App](https://github.com/facebookincubator/create-react-app). Для маршрутизации запросов была добавлена библиотека [React Router](https://reacttraining.com/react-router/), для управления состоянием приложения – [Redux](http://redux.js.org/) и, наконец, [React-Bootstrap](https://react-bootstrap.github.io) – в качестве библиотеки компонентов. В процессе разработки я активно пользовался статьями [Юрия Дымова](https://habrahabr.ru/users/yury-dymov/) и переводами пользователя [@ru_vds](https://habrahabr.ru/users/ru_vds/)  на habrahabr.ru, за что им огромное спасибо.

[Бэкенд](api) я создал вручную как простое приложение на [Express](expressjs.com) ([express-generator](http://expressjs.com/en/starter/generator.html) мне показался избыточным). Для настройки транспиляции я воспользовался статьёй [Example Node Server w/ Babel](https://github.com/babel/example-node-server). Библиотека [cheerio](https://cheerio.js.org) была добавлена для поиска и извлечения интересующего содержимого из сайтов с текстами песен, [musicmetadata](https://github.com/leetreveil/musicmetadata) – для чтения метаданных аудио-файлов.


Весь процесс разработки, включая отладку, происходил в [Visual Studio Code](https://code.visualstudio.com).

## Функциональность
Приложение автоматизирует поиск текстов песен, позволяя одновременно слушать и читать. В качестве источников текстов используются сайты http://www.falshivim-vmeste.ru (к текстам тут прилагаются также аккорды и/или гитарные табулатуры) и http://www.amalgama-lab.com (переводы текстов на русский язык).

## Импорт
```
git clone https://github.com/catonymous/mulyrix
cd mulyrix/api
npm install
cd ../ui
npm install
cd ..
```

## Запуск
Перед запуском необходимо скопировать в поддиректорию `/media` аудио-файлы (поддерживаемые форматы файлов перечислены [тут](https://github.com/leetreveil/musicmetadata#supports)). Структура директорий и названия файлов значения не имеют. Важно – чтобы правильно были заполнены метаданные, потому что именно на их основе построен интерфейс приложения.

Также нужно иметь в виду, что метаданные файлов подтягиваются/обновляются в приложении только после нажатия на кнопку `Запустить сканирование` на главной странице.

И последнее замечание, прежде чем мы начнём всё запускать: машина, на которой будет запускаться [бэкенд](api), должна иметь доступ в Интернет, иначе никаких текстов в интерфейсе мы не увидим.

### Режим разработки
В первом терминале запускаем [бэкенд](api):
```
cd api
npm start
```

Во втором – [фронтенд](ui):
```
cd ui
npm start
```
Последняя команда автоматически откроет новую вкладку в Google Chrome по адресу http://localhost:3000/ (или перезагрузит уже открытую вкладку, не меняя адреса). Панель отладки Redux можно скрыть нажатием `Ctrl+H` или переместить – `Ctrl+Q`.

Любое изменение исходных текстов как [бэкенда](api), так и [фронтенда](ui) будет подхватываться автоматически. Оба процесса можно остановить нажатием `Ctrl+C` в соответствующем терминале.

### Производственный режим
Описанная ниже инструкция будет работать только в [UNIX-подобных операционных системах](https://ru.wikipedia.org/wiki/UNIX-подобная_операционная_система). Лично я проверял их только в [macOS Sierra](https://www.apple.com/ru/macos/sierra/).

Сначала нужно установить [NGINX](https://nginx.org), если он ещё не установлен.

>В macOS это можно сделать с помощью утилиты [Homebrew](https://brew.sh):
>```
>brew install nginx


Далее следует отредактировать файл [nginx.conf](nginx.conf), заменив абсолютный путь до файла настроек по-умолчанию на тот, который соответствует установленному на Вашей машине NGINX:
```
   include /usr/local/etc/nginx/mime.types.default;
```

Теперь, когда всё готово для запуска, выполняем сборку, запускаем [бэкенд](api) и NGINX:
```
cd api
npm run build
npm run serve
cd ../ui
npm run build
cd ..
nginx -c nginx.conf -p "`pwd`"
```

Прежде чем открыть приложение в браузере, уточните, какой IP-адрес сетевого интерфейса, через который Вы подключены к Интернету.
>В macOS это можно узнать, выполнив следующую команду (вместо `en0` подставьте название своего сетевого интерфейса):
> ```
>ipconfig getifaddr en0
Этот IP-адрес мы будем использовать вместо `127.0.0.1` и `localhost`, т.к. NGINX по неизвестной мне пока причине ошибается в сопоставлении `location` для `localhost` (вероятно, это как-то связано с тем, что браузер режет заголовки запросов, идущих из фреймов – я решил не углубляться в эти "дебри", потому что нашёл способ их обойти).

Итак, если искомый IP-адрес равен, например, `192.168.1.2`, то в браузере необходимо открыть адрес  http://192.168.1.2:5000.


Остановить NGINX и [бэкенд](api) можно следующими командами:
```
nginx -s stop
cd api
npm run unserve
```